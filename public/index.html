<!doctype html>

<!--
    Name of the App : NodeJS Chat Example
    Description : A simple multiroom chat application to showcase Node.js and Socket.io
-->

<html lang="en">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <head>
        <title>Chat Rooms - Home</title>

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

        <!-- CSS -->
        <link rel="stylesheet" href="/css/chat.css">

    </head>

    <body>
        <div class="container">
            <div class="row jumbotron">
                <h1>Chat Rooms</h1>

                <p>A simple multiroom chat application to showcase Node.js and Socket.io</p>

            </div>

            <div class="row">
                <div class="col-md-10">
                    <div class="room-header">Welcome Guest3, you are in Lobby!</div>

                    <div id="messages" ><div><span class="text-primary">Guest1 - </span>Msg1...</div><div><span class="text-primary">Guest2 - </span>Msg2...</div></div>

                    <form id="message-form" class="form-inline">
                        <input id="message" type="text" class="form-control" placeholder="Enter a message">

                        <button id="send" class="btn btn-default" type="submit">Send</button><span> or Press Enter</span>

                    </form>

                    <div class="help">
                        Chat commands:

                        <ul>
                            <li>Change your user name: <code>/name [user name]</code></li>

                            <li>Join / Create Room: <code>/join [room name]</code></li>

                        </ul>
                    </div>
                </div>

                 <div class="col-md-2">
                    <div class="room-header">Rooms</div>

                    <div id="room-list"><div class="room selected">Lobby</div><div class="room">Room 1</div><div class="room">Room 2</div></div>

                </div>
            </div>
        </div>

        <!-- Scripts - external -->
        <script src="/socket.io/socket.io.js"></script>  <!-- Socket.io -->
        <script src="//code.jquery.com/jquery-1.11.3.min.js"></script> <!-- jQuery -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script> <!-- Bootstrap -->

        <!-- Scripts -->
        <script src="/js/chat.js"></script>
        <script src="/js/chat_client.js"></script>

        <script>

            $(function() {
                var socket = io();
                var myName = "Not assigned";

                socket.on('new name', function(newClientName) {
                    console.log('Hello, your assigned name is ' + newClientName);
                    myName = newClientName;
                });

                socket.on('disconnect', function(clientName) {
                    console.log('User ' + clientName + ' has left Chat rooms!');
                });

                socket.on('user joined room', function(clientName) {
                    console.log('User ' + clientName + ' has joined!');
                });

                socket.on('user left room', function(clientName) {
                    console.log('User ' + clientName + ' has left!');
                });

                socket.on('room joined', function(roomName) {
                    console.log('You have joined ' + roomName + "!");
                    if(roomName === "lobby")
                        socket.emit('change name', 'Guest1');
                    else
                        socket.emit('new msg', "Hello everybody from " + myName);
                });

                socket.on('user message', function(message) {
                    console.log(message.name + ' - ' + message.text);
                });

                socket.on('same name', function(clientName) {
                    console.log("Your name is already " + clientName);
                });

                socket.on('name taken', function(newClientName) {
                    console.log(newClientName + " is already taken! Please try another name");
                    if(newClientName == "Guest1") {
                        socket.emit('change name', 'Vikram'); console.log('requesting name - Vikram');
                    }
                    if(newClientName == "Vikram") {
                        socket.emit('change name', 'Shwetha');  console.log('requesting name - Shwetha');
                    }
                    else if(newClientName == "Shwetha") {
                        socket.emit('change name', 'Ritwik');  console.log('requesting name - Ritwik');
                    }

                });

                socket.on('name invalid guest', function(newClientName) {
                    console.log(newClientName + " : Client Name starts with 'Guest' and is invalid! Try another name");
                    socket.emit('change name', 'Vikram');
                });

                socket.on('name changed', function(newClientName) {
                    console.log('Name changed to ' + newClientName + " successfully!");
                    myName = newClientName;
                    if(newClientName === "Vikram" || newClientName === "Ritwik")
                        socket.emit('join room', "Room 1");
                    socket.emit('rooms')
                });

                socket.on('user name changed', function(message) {
                    console.log('User ' + message.oldName + "'s name is changed to " + message.newName + "!");
                });

                socket.on('same room', function(clientName) {
                    console.log("You are already in room : " + clientName);
                });
                
                socket.on('rooms list', function(rooms) {
                    console.log("Rooms : " + rooms.join(', '));
                });

            });
        
        </script>
    </body>
</html>
